/*!
 * As-Select3 - Modern JavaScript Select Library
 * Version: 1.0.2
 * Author: Sunil Kumar
 * Repository: https://github.com/sunil4587/As-select3
 * License: MIT
 */
!function(e){"use strict";class t{constructor(t,s={}){if(this.$e=e(t),!this.$e.length)throw new Error(`As-Select3: Element "${t}" not found`);this.el=this.$e[0];let i=this.$e.closest(".as-select3-container");i.length||(i=e('<div class="as-select3-container"></div>'),this.$e.before(i),i.append(this.$e)),this.$c=i,this.multi=void 0!==this.$e.attr("multiple"),this.opts=e.extend({placeholder:this.multi?"Select options...":"Choose an option...",searchable:!1!==this.$e.data("search"),selectAll:!1!==s.selectAll&&this.multi,clearAll:!1!==s.clearAll,maxSelection:s.maxSelection||null,remote:s.remote||null,searchDelay:s.searchDelay||300,noResultsText:"No results found",loadingText:"Loading...",searchPlaceholder:"Search options...",selectAllText:"Select All",clearAllText:"Clear All"},s),this.open=!1,this.focus=-1,this.vals=this.multi?[]:(this.$e.find("option:selected").val()||null),this.loading=!1,this.timer=null,this.orig=[],this.init()}init(){this.createUI(),this.bindEvents(),this.updateFromSelect(),this.storeOrig()}createUI(){this.$t=e('<div class="as-select3-trigger" tabindex="0" role="combobox" aria-expanded="false"></div>'),this.$s=e('<div class="as-select3-selection"></div>'),this.$p=e(`<span class="as-select3-placeholder">${this.opts.placeholder}</span>`),this.$a=e('<i class="bi bi-chevron-down as-select3-arrow"></i>'),this.$s.append(this.$p),this.$t.append(this.$s,this.$a),this.$c.append(this.$t),this.$e.addClass("d-none"),this.createDropdown()}createDropdown(){this.$d=e('<div class="as-select3-dropdown" role="listbox"></div>'),this.opts.searchable&&this.createSearch(),this.createOptions(),(this.opts.selectAll||this.opts.clearAll)&&this.createActions(),this.$c.append(this.$d)}createSearch(){const t=e('<div class="as-select3-search"><div class="position-relative w-100"></div></div>');this.$i=e('<input type="text" class="form-control form-control-sm" role="searchbox">').attr("placeholder",this.opts.searchPlaceholder);const s=e('<i class="bi bi-x as-select3-search-clear"></i>');t.find("div").append(this.$i,s),this.$d.append(t)}createOptions(){this.$o=e('<div class="as-select3-options"></div>'),this.$e.find("option").each(((t,s)=>this.$o.append(this.createOpt(s,t)))),this.$d.append(this.$o)}createOpt(t,s){const i=t instanceof HTMLOptionElement?{val:t.value,txt:t.text,sel:t.selected,ico:e(t).data("icon")}:{val:t.value||t.val,txt:t.text||t.label,sel:!!t.selected,ico:t.icon},n=e('<div class="as-select3-option" role="option" tabindex="-1"></div>').data({value:i.val,index:s,icon:i.ico}).attr("aria-selected",i.sel.toString()),l=e('<div class="as-select3-option-left"></div>');if(i.ico){const t=e('<div class="as-select3-option-icon"></div>');this.addIcon(t,i.ico,"16px"),l.append(t)}return l.append(e('<span class="as-select3-option-text"></span>').text(i.txt)),n.append(l),this.multi&&n.append(e('<input type="checkbox" class="form-check-input">').prop("checked",i.sel)),i.sel&&n.addClass("selected"),n}addIcon(t,s,i="14px"){if(s.match(/^(https?:|data:|\.?\/)/))t.append(e("<img>").attr({src:s,alt:""}).css({width:i,height:i,objectFit:"cover"}));else if(s.startsWith("bi-"))t.append(e("<i>").addClass("bi "+s));else t.html(s)}createActions(){if(!this.multi)return;const t=e('<div class="as-select3-actions"></div>');this.opts.selectAll&&t.append(e('<button type="button" class="btn btn-sm btn-outline-primary"></button>').text(this.opts.selectAllText).on("click",()=>this.selectAll())),this.opts.clearAll&&t.append(e('<button type="button" class="btn btn-sm btn-outline-secondary"></button>').text(this.opts.clearAllText).on("click",()=>this.clearAll())),this.$d.append(t)}bindEvents(){this.$t.on("click",t=>{e(t.target).hasClass("as-select3-clear")||(t.preventDefault(),this.toggle())}),this.$c.on("click",".as-select3-clear",t=>(t.stopPropagation(),t.preventDefault(),this.clearSingle(),!1)).on("click",".as-select3-tag-remove",t=>{t.stopPropagation(),t.preventDefault();const s=e(t.target).closest(".as-select3-tag").data("value");return s&&this.removeTag(s),!1}).on("click",".as-select3-search-clear",t=>(t.stopPropagation(),t.preventDefault(),this.$i&&this.$i.val("").trigger("input").focus(),!1)),this.$t.on("keydown",e=>this.handleKey(e)),this.$i&&(this.$i.on("input",e=>{const t=e.target.value;this.opts.remote?(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.remoteSearch(t),this.opts.searchDelay)):this.search(t)}),this.$i.on("keydown",e=>{"Escape"===e.key&&this.close()})),this.$o.on("click",".as-select3-option",t=>{if(e(t.currentTarget).hasClass("disabled"))return!1;this.toggleOpt(e(t.currentTarget))}),e(document).on("click.asSelect3",e=>{this.$c.is(e.target)||this.$c.has(e.target).length||this.close()}),this.$e.on("invalid",()=>this.$t.addClass("is-invalid")).closest("form").on("reset.asSelect3",()=>setTimeout(()=>this.reset(),0))}handleKey(e){const{key:t}=e;switch(t){case"Enter":case" ":if(e.preventDefault(),this.open){const e=this.$o.find(".focused");e.length&&this.toggleOpt(e)}else this.openDropdown();break;case"Escape":this.open&&(e.preventDefault(),this.close());break;case"ArrowDown":e.preventDefault(),this.open?this.focusNext():this.openDropdown();break;case"ArrowUp":e.preventDefault(),this.open?this.focusPrev():this.openDropdown();break;case"Tab":this.open&&(e.preventDefault(),this.focusNext())}}focusNext(){const e=this.$o.find(".as-select3-option:visible:not(.disabled)");e.length&&(this.$o.find(".focused").removeClass("focused"),this.focus=this.focus<e.length-1?this.focus+1:0,this.scrollToOpt(e.eq(this.focus).addClass("focused")))}focusPrev(){const e=this.$o.find(".as-select3-option:visible:not(.disabled)");e.length&&(this.$o.find(".focused").removeClass("focused"),this.focus=this.focus>0?this.focus-1:e.length-1,this.scrollToOpt(e.eq(this.focus).addClass("focused")))}scrollToOpt(e){if(!e.length)return;const t=this.$o[0],s=e[0].offsetTop,i=s+e[0].offsetHeight;s<t.scrollTop?t.scrollTop=s:i>t.scrollTop+t.clientHeight&&(t.scrollTop=i-t.clientHeight)}toggle(){this.open?this.close():this.openDropdown()}openDropdown(){this.open||(this.open=!0,this.$d.addClass("show"),this.$t.addClass("active").attr("aria-expanded","true"),this.$i&&this.$i.focus(),this.$e.trigger("asSelect3:open"))}close(){this.open&&(this.open=!1,this.$d.removeClass("show"),this.$t.removeClass("active").attr("aria-expanded","false"),this.$o.find(".focused").removeClass("focused"),this.focus=-1,this.$i&&(this.$i.val(""),this.search("")),this.$e.trigger("asSelect3:close"))}toggleOpt(e){if(!e?.length||e.hasClass("disabled"))return;const t=e.data("value"),s=this.$e.find(`option[value="${t}"]`);if(!s.length)return;const i=e.hasClass("selected");if(i?(s.prop("selected",!1),e.removeClass("selected").attr("aria-selected","false"),this.multi?(e.find('input[type="checkbox"]').prop("checked",!1),this.vals=this.vals.filter(e=>e!==t)):this.vals=null):(this.multi?(this.opts.maxSelection&&this.vals.length>=this.opts.maxSelection?this.$e.trigger("asSelect3:maxselection",{max:this.opts.maxSelection}):this.vals.push(t)):(this.$o.find(".as-select3-option").removeClass("selected").attr("aria-selected","false"),this.$e.find("option").prop("selected",!1),this.vals=t),s.prop("selected",!0),e.addClass("selected").attr("aria-selected","true"),this.multi?e.find('input[type="checkbox"]').prop("checked",!0):this.close()),!i||this.multi)this.$t.removeClass("is-invalid"),this.updateSelection(),this.$e.trigger("change").trigger("asSelect3:change",{value:this.getValue()})}search(t){const s=this.$o.find(".as-select3-option").not(".as-select3-no-results, .as-select3-loading");let i=!1;s.each((s,n)=>{const l=e(n).text().toLowerCase().includes(t.toLowerCase());e(n).toggle(l),l&&(i=!0)}),this.toggleNoResults(!i&&t.length>0),this.focus=-1}async remoteSearch(e){if(!this.opts.remote||"function"!=typeof this.opts.remote)return;this.showLoading();try{const t=await this.opts.remote(e);Array.isArray(t)?this.populateOptions(t):t?.options&&Array.isArray(t.options)?this.populateOptions(t.options):console.warn("Invalid remote response")}catch(e){console.error("Remote search error:",e),this.showNoResults(),this.$e.trigger("asSelect3:error",{error:e})}finally{this.hideLoading()}}showLoading(){this.loading=!0,this.hideNoResults(),this.$o.find(".as-select3-option").hide();const t=".as-select3-loading";this.$o.find(t).length||this.$o.append(e(`<div class="${t.substring(1)}"><div class="spinner-border spinner-border-sm me-2"></div>${this.opts.loadingText}</div>`))}hideLoading(){this.loading=!1,this.$o.find(".as-select3-loading").remove(),this.$o.find(".as-select3-option").show()}toggleNoResults(t){const s=".as-select3-no-results",i=this.$o.find(s);t&&!i.length?this.$o.append(e(`<div class="${s.substring(1)}"><i class="bi bi-search me-2"></i>${this.opts.noResultsText}</div>`)):!t&&i.length&&i.remove()}hideNoResults(){this.$o.find(".as-select3-no-results").remove()}selectAll(){this.multi&&(this.$e.find("option").prop("selected",!0),this.$o.find(".as-select3-option").addClass("selected").attr("aria-selected","true"),this.$o.find('input[type="checkbox"]').prop("checked",!0),this.updateFromSelect(),this.$e.trigger("change").trigger("asSelect3:selectall"))}clearAll(){this.$e.find("option").prop("selected",!1),this.multi?(this.vals=[],this.$o.find(".as-select3-option").removeClass("selected").attr("aria-selected","false"),this.$o.find('input[type="checkbox"]').prop("checked",!1)):(this.vals=null,this.$o.find(".as-select3-option").removeClass("selected").attr("aria-selected","false")),this.updateSelection(),this.$e.trigger("change").trigger("asSelect3:clearall")}async loadData(e,t={}){this.showLoading();try{const s=new URLSearchParams(t).toString(),i=await fetch(s?`${e}?${s}`:e);if(!i.ok)throw new Error(`HTTP ${i.status}`);const n=await i.json();n.options&&Array.isArray(n.options)?this.populateOptions(n.options):Array.isArray(n)?this.populateOptions(n):console.warn("Invalid data format"),this.$e.trigger("asSelect3:dataloaded",{data:n})}catch(e){console.error("Load data error:",e),this.showNoResults(),this.$e.trigger("asSelect3:dataerror",{error:e})}finally{this.hideLoading()}}updateSelection(){if(this.$s.empty(),this.multi)this.vals.length?this.vals.forEach(e=>{const t=this.$e.find(`option[value="${e}"]`);t.length&&this.$s.append(this.createTag(t.text(),e))}):this.$s.append(this.$p);else if(this.vals){const t=this.$e.find(`option[value="${this.vals}"]`);if(t.length){const s=e('<div class="as-select3-single-container"></div>'),i=e('<span class="as-select3-single-value"></span>'),n=e('<i class="bi bi-x as-select3-clear"></i>').attr("data-value",this.vals);let l=this.$o.find(`[data-value="${this.vals}"]`).data("icon")||t.data("icon");if(l){const t=e('<div class="as-select3-single-icon"></div>');this.addIcon(t,l,"16px"),i.append(t)}i.append(e("<span></span>").text(t.text())),s.append(i,n),this.$s.append(s)}}else this.$s.append(this.$p);this.updateOptStates()}updateOptStates(){if(!this.multi||!this.opts.maxSelection)return;const t=this.vals.length>=this.opts.maxSelection;this.$o.find(".as-select3-option").each((s,i)=>{const n=e(i),l=n.hasClass("selected"),o=n.find('input[type="checkbox"]');t&&!l?(n.addClass("disabled").attr("aria-disabled","true"),o.prop("disabled",!0)):(n.removeClass("disabled").attr("aria-disabled","false"),o.prop("disabled",!1))})}createTag(t,s){const i=e('<span class="as-select3-tag"></span>').data("value",s),n=e('<span class="as-select3-tag-text"></span>').text(t).attr("title",t),l=e('<i class="bi bi-x as-select3-tag-remove"></i>');let o=this.$o.find(`[data-value="${s}"]`).data("icon")||this.$e.find(`option[value="${s}"]`).data("icon");if(o){const t=e('<div class="as-select3-tag-icon"></div>');this.addIcon(t,o),i.append(t)}return i.append(n,l)}removeTag(e){const t=this.$e.find(`option[value="${e}"]`),s=this.$o.find(`[data-value="${e}"]`);t.length&&(t.prop("selected",!1),this.multi?(s.find('input[type="checkbox"]').prop("checked",!1),this.vals=this.vals.filter(t=>t!==e)):this.vals=null,s.removeClass("selected").attr("aria-selected","false"),this.updateSelection(),this.$e.trigger("change").trigger("asSelect3:tagremoved",{value:e}))}clearSingle(){this.vals=null,this.$e.find("option").prop("selected",!1),this.$o.find(".as-select3-option").removeClass("selected").attr("aria-selected","false"),this.updateSelection(),this.$e.trigger("change").trigger("asSelect3:cleared")}clearSelection(){this.multi?this.clearAll():this.clearSingle()}updateFromSelect(){this.multi?(this.vals=[],this.$e.find("option:selected").each((e,t)=>this.vals.push(t.value))):(this.vals=this.$e.find("option:selected").val()||null),this.updateSelection()}storeOrig(){this.orig=this.$e.find("option").map(function(){return{value:this.value,text:this.text,selected:this.selected}}).get()}populateOptions(t=[]){this.$e.empty(),this.$o.empty(),t.forEach((t,s)=>{const i=e("<option></option>").val(t.value).text(t.text||t.label).prop("selected",!!t.selected);t.icon&&i.data("icon",t.icon),this.$e.append(i),this.$o.append(this.createOpt({value:t.value,text:t.text||t.label,selected:!!t.selected,icon:t.icon},s))}),this.updateFromSelect()}addOption(t){const s=e("<option></option>").val(t.value).text(t.text||t.label).prop("selected",!!t.selected);return t.icon&&s.data("icon",t.icon),this.$e.append(s),this.$o.append(this.createOpt(t,this.$e.find("option").length-1)),t.selected&&this.updateFromSelect(),this.$e.trigger("asSelect3:optionadded",{option:t}),s}removeOption(e){this.$e.find(`option[value="${e}"]`).remove(),this.$o.find(`[data-value="${e}"]`).remove(),this.multi?this.vals=this.vals.filter(t=>t!==e):this.vals===e&&(this.vals=null),this.updateSelection(),this.$e.trigger("asSelect3:optionremoved",{value:e})}clearOptions(){this.$e.empty(),this.$o.empty(),this.vals=this.multi?[]:null,this.updateSelection(),this.$e.trigger("asSelect3:optionscleared")}refreshOptions(){this.$o.empty(),this.$e.find("option").each((e,t)=>this.$o.append(this.createOpt(t,e))),this.updateFromSelect()}getValue(){return this.vals}setValue(e){Array.isArray(e)&&this.multi?(this.$e.find("option").prop("selected",!1),e.forEach(e=>this.$e.find(`option[value="${e}"]`).prop("selected",!0))):!Array.isArray(e)&&!this.multi&&(this.$e.find("option").prop("selected",!1),this.$e.find(`option[value="${e}"]`).prop("selected",!0)),this.updateFromSelect(),this.$e.trigger("change").trigger("asSelect3:valuechanged",{value:this.getValue()})}reset(){this.clearAll(),this.orig.forEach(e=>{e.selected&&(this.multi?this.vals.push(e.value):this.vals=e.value)}),this.updateFromSelect()}enable(){this.$c.removeClass("disabled"),this.$t.attr("tabindex","0"),this.$e.prop("disabled",!1)}disable(){this.close(),this.$c.addClass("disabled"),this.$t.attr("tabindex","-1"),this.$e.prop("disabled",!0)}destroy(){return this.close(),this.$t.off(),this.$c.off(),this.$o.off(),e(document).off("click.asSelect3"),this.$e.off("invalid").closest("form").off("reset.asSelect3"),this.$e.removeClass("d-none").insertAfter(this.$c),this.$c.remove(),delete this.el._asSelect3,this.$e}}e.fn.asSelect3=function(e){return this.each(function(){this._asSelect3||(this._asSelect3=new t(this,e))})},t.autoInit=function(s=".as-select3-container select"){return e(s).filter(function(){return!this._asSelect3}).map(function(){const e=new t(this);return this._asSelect3=e,e}).get()},window.AsSelect3=t}(jQuery);