/*!
 * As-Select3 - Modern JavaScript Select Library
 * Version: 1.0.0
 * Author: Sunil Kumar
 * Repository: https://github.com/sunil4587/As-select3
 * License: MIT
 */
!function(e){"use strict";class t{constructor(t,s={}){if(this.$e=e(t),!this.$e.length)throw new Error(`As-Select3: Element "${t}" not found`);this.el=this.$e[0];let i=this.$e.closest(".as-select3-container");i.length||(i=e('<div class="as-select3-container"></div>'),this.$e.before(i),i.append(this.$e)),this.$c=i,this.multi=void 0!==this.$e.attr("multiple"),this.opts=e.extend({placeholder:this.multi?"Select options...":"Choose an option...",searchable:!1!==this.$e.data("search"),selectAll:!1!==s.selectAll&&this.multi,clearAll:!1!==s.clearAll,maxSelection:s.maxSelection||null,remote:s.remote||null,searchDelay:s.searchDelay||300,noResultsText:"No results found",loadingText:"Loading...",searchPlaceholder:"Search options...",selectAllText:"Select All",clearAllText:"Clear All",defaultIconClass:"bi bi-chevron-down",iconPrefix:s.iconPrefix||null,escapeMarkup:s.escapeMarkup||function(e){return e},templateResult:s.templateResult||null,templateSelection:s.templateSelection||null,allowHtml:!1!==s.allowHtml,matcher:s.matcher||null},s),this.open=!1,this.focus=-1,this.vals=this.multi?[]:(this.$e.find("option:selected").val()||null),this.loading=!1,this.timer=null,this.orig=[],this.init()}init(){this.createUI(),this.bindEvents(),this.updateFromSelect(),this.storeOrig()}createUI(){this.$t=e('<div class="as-select3-trigger" tabindex="0" role="combobox" aria-expanded="false"></div>'),this.$s=e('<div class="as-select3-selection"></div>'),this.$p=e(`<span class="as-select3-placeholder">${this.opts.placeholder}</span>`),this.$a=e(`<i class="${this.opts.defaultIconClass} as-select3-arrow"></i>`),this.$s.append(this.$p),this.$t.append(this.$s,this.$a),this.$c.append(this.$t),this.$e.addClass("d-none"),this.createDropdown()}createDropdown(){this.$d=e('<div class="as-select3-dropdown" role="listbox"></div>'),this.opts.searchable&&this.createSearch(),this.createOptions(),(this.opts.selectAll||this.opts.clearAll)&&this.createActions(),this.$c.append(this.$d)}createSearch(){const t=e('<div class="as-select3-search"><div class="position-relative w-100"></div></div>');this.$i=e('<input type="text" class="form-control form-control-sm" role="searchbox">').attr("placeholder",this.opts.searchPlaceholder);const s=e(`<i class="${this.getCloseIcon()} as-select3-search-clear"></i>`);t.find("div").append(this.$i,s),this.$d.append(t)}createOptions(){this.$o=e('<div class="as-select3-options"></div>'),this.$e.find("option").each(((t,s)=>this.$o.append(this.createOpt(s,t)))),this.$d.append(this.$o)}createOpt(t,s){const i=t instanceof HTMLOptionElement?{val:t.value,txt:t.text,sel:t.selected,ico:e(t).data("icon"),html:e(t).data("html")||e(t).html(),disabled:t.disabled}:{val:t.value||t.val,txt:t.text||t.label,sel:!!t.selected,ico:t.icon,html:t.html||t.text||t.label,disabled:!!t.disabled},n=e('<div class="as-select3-option" role="option" tabindex="-1"></div>').data({value:i.val,index:s,icon:i.ico,html:i.html,text:i.txt}).attr("aria-selected",i.sel.toString()),l=e('<div class="as-select3-option-left"></div>');if(this.opts.templateResult&&"function"==typeof this.opts.templateResult){const e=this.opts.templateResult(i);e&&l.html(e)}else if(this.opts.allowHtml&&i.html&&i.html!==i.txt){l.html(this.opts.escapeMarkup(i.html))}else{if(i.ico){const t=e('<div class="as-select3-option-icon"></div>');this.addIcon(t,i.ico,"16px"),l.append(t)}l.append(e('<span class="as-select3-option-text"></span>').text(i.txt))}return n.append(l),this.multi&&n.append(e('<input type="checkbox" class="form-check-input">').prop("checked",i.sel)),i.sel&&n.addClass("selected"),i.disabled&&n.addClass("disabled").attr("aria-disabled","true"),n}addIcon(t,s,i="14px"){if(!s)return;if(s.match(/^(https?:|data:|\.?\/)/)){t.append(e("<img>").attr({src:s,alt:""}).css({width:i,height:i,objectFit:"cover"}))}else if(this.isIconClass(s)){const i=e("<i></i>").addClass(s);t.append(i)}else{t.html(s)}}isIconClass(e){if(!e||"string"!=typeof e)return!1;const t=["bi-","fa-","fas-","far-","fab-","fal-","fad-","material-icons","icon-","glyphicon-","mdi-","feather-","lucide-","tabler-icon-","heroicon-","phosphor-","remix-"];return t.some(t=>e.includes(t))||e.match(/^(bi|fa|fas|far|fab|fal|fad|material-icons|icon|glyphicon|mdi|feather|lucide|tabler|heroicon|phosphor|remix)\s/)||this.opts.iconPrefix&&e.startsWith(this.opts.iconPrefix)}getCloseIcon(){if(this.opts.defaultIconClass.includes("fa"))return"fas fa-times";if(this.opts.defaultIconClass.includes("material"))return"material-icons";if(this.opts.defaultIconClass.includes("feather"))return"feather feather-x";if(this.opts.defaultIconClass.includes("lucide"))return"lucide lucide-x";return"bi bi-x"}createActions(){if(!this.multi)return;const t=e('<div class="as-select3-actions"></div>');this.opts.selectAll&&t.append(e('<button type="button" class="btn btn-sm btn-outline-primary"></button>').text(this.opts.selectAllText).on("click",()=>this.selectAll())),this.opts.clearAll&&t.append(e('<button type="button" class="btn btn-sm btn-outline-secondary"></button>').text(this.opts.clearAllText).on("click",()=>this.clearAll())),this.$d.append(t)}bindEvents(){this.$t.on("click",t=>{e(t.target).hasClass("as-select3-clear")||(t.preventDefault(),this.toggle())}),this.$c.on("click",".as-select3-clear",t=>(t.stopPropagation(),t.preventDefault(),this.clearSingle(),!1)).on("click",".as-select3-tag-remove",t=>{t.stopPropagation(),t.preventDefault();const s=e(t.target).closest(".as-select3-tag").data("value");return s&&this.removeTag(s),!1}).on("click",".as-select3-search-clear",t=>(t.stopPropagation(),t.preventDefault(),this.$i&&this.$i.val("").trigger("input").focus(),!1)),this.$t.on("keydown",e=>this.handleKey(e)),this.$i&&(this.$i.on("input",e=>{const t=e.target.value;this.opts.remote?(this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.remoteSearch(t),this.opts.searchDelay)):this.search(t)}),this.$i.on("keydown",e=>{"Escape"===e.key&&this.close()})),this.$o.on("click",".as-select3-option",t=>{const s=e(t.currentTarget);if(s.hasClass("disabled"))return!1;this.toggleOpt(s)}),e(document).on("click.asSelect3",e=>{this.$c.is(e.target)||this.$c.has(e.target).length||this.close()}),this.$e.on("invalid",()=>this.$t.addClass("is-invalid")).closest("form").on("reset.asSelect3",()=>setTimeout(()=>this.reset(),0))}handleKey(e){const{key:t}=e;switch(t){case"Enter":case" ":if(e.preventDefault(),this.open){const e=this.$o.find(".focused");e.length&&this.toggleOpt(e)}else this.openDropdown();break;case"Escape":this.open&&(e.preventDefault(),this.close());break;case"ArrowDown":e.preventDefault(),this.open?this.focusNext():this.openDropdown();break;case"ArrowUp":e.preventDefault(),this.open?this.focusPrev():this.openDropdown();break;case"Tab":this.open&&(e.preventDefault(),this.focusNext())}}focusNext(){const e=this.$o.find(".as-select3-option:visible:not(.disabled)");e.length&&(this.$o.find(".focused").removeClass("focused"),this.focus=this.focus<e.length-1?this.focus+1:0,this.scrollToOpt(e.eq(this.focus).addClass("focused")))}focusPrev(){const e=this.$o.find(".as-select3-option:visible:not(.disabled)");e.length&&(this.$o.find(".focused").removeClass("focused"),this.focus=this.focus>0?this.focus-1:e.length-1,this.scrollToOpt(e.eq(this.focus).addClass("focused")))}scrollToOpt(e){if(!e.length)return;const t=this.$o[0],s=e[0].offsetTop,i=s+e[0].offsetHeight;s<t.scrollTop?t.scrollTop=s:i>t.scrollTop+t.clientHeight&&(t.scrollTop=i-t.clientHeight)}toggle(){this.open?this.close():this.openDropdown()}openDropdown(){this.open||(this.open=!0,this.$d.addClass("show"),this.$t.addClass("active").attr("aria-expanded","true"),this.$i&&this.$i.focus(),this.$e.trigger("asSelect3:open"))}close(){this.open&&(this.open=!1,this.$d.removeClass("show"),this.$t.removeClass("active").attr("aria-expanded","false"),this.$o.find(".focused").removeClass("focused"),this.focus=-1,this.$i&&(this.$i.val(""),this.search("")),this.$e.trigger("asSelect3:close"))}toggleOpt(t){if(!t?.length||t.hasClass("disabled"))return;const s=t.data("value"),i=this.$e.find(`option[value="${s}"]`);if(!i.length)return;const n=t.hasClass("selected");if(n?(i.prop("selected",!1),t.removeClass("selected").attr("aria-selected","false"),this.multi?(t.find('input[type="checkbox"]').prop("checked",!1),this.vals=this.vals.filter(e=>e!==s)):this.vals=null):(this.multi?(this.opts.maxSelection&&this.vals.length>=this.opts.maxSelection?this.$e.trigger("asSelect3:maxselection",{max:this.opts.maxSelection}):this.vals.push(s)):(this.$o.find(".as-select3-option").removeClass("selected").attr("aria-selected","false"),this.$e.find("option").prop("selected",!1),this.vals=s),i.prop("selected",!0),t.addClass("selected").attr("aria-selected","true"),this.multi?t.find('input[type="checkbox"]').prop("checked",!0):this.close()),!n||this.multi)this.$t.removeClass("is-invalid"),this.updateSelection(),this.$e.trigger("change").trigger("asSelect3:change",{value:this.getValue()})}search(t){if(this.opts.matcher&&"function"==typeof this.opts.matcher){this.customSearch(t);return}const s=this.$o.find(".as-select3-option").not(".as-select3-no-results, .as-select3-loading");let i=!1;s.each((s,n)=>{const l=e(n),o=l.data("text")||l.text(),a=this.matchText(o,t);l.toggle(a),a&&(i=!0)}),this.toggleNoResults(!i&&t.length>0),this.focus=-1}customSearch(t){const s=this.$o.find(".as-select3-option").not(".as-select3-no-results, .as-select3-loading");let i=!1;s.each((s,n)=>{const l=e(n),o={id:l.data("value"),text:l.data("text")||l.text(),html:l.data("html")},a=this.opts.matcher(t,o);l.toggle(a),a&&(i=!0)}),this.toggleNoResults(!i&&t.length>0),this.focus=-1}matchText(e,t){return e.toLowerCase().includes(t.toLowerCase())}async remoteSearch(e){if(!this.opts.remote||"function"!=typeof this.opts.remote)return;this.showLoading();try{const t=await this.opts.remote(e);Array.isArray(t)?this.populateOptions(t):t?.options&&Array.isArray(t.options)?this.populateOptions(t.options):console.warn("Invalid remote response")}catch(e){console.error("Remote search error:",e),this.showNoResults(),this.$e.trigger("asSelect3:error",{error:e})}finally{this.hideLoading()}}showLoading(){this.loading=!0,this.hideNoResults(),this.$o.find(".as-select3-option").hide();const t=".as-select3-loading";this.$o.find(t).length||this.$o.append(e(`<div class="${t.substring(1)}"><div class="spinner-border spinner-border-sm me-2"></div>${this.opts.loadingText}</div>`))}hideLoading(){this.loading=!1,this.$o.find(".as-select3-loading").remove(),this.$o.find(".as-select3-option").show()}toggleNoResults(t){const s=".as-select3-no-results",i=this.$o.find(s);t&&!i.length?this.$o.append(e(`<div class="${s.substring(1)}"><i class="${this.getSearchIcon()} me-2"></i>${this.opts.noResultsText}</div>`)):!t&&i.length&&i.remove()}getSearchIcon(){if(this.opts.defaultIconClass.includes("fa"))return"fas fa-search";if(this.opts.defaultIconClass.includes("material"))return"material-icons";if(this.opts.defaultIconClass.includes("feather"))return"feather feather-search";if(this.opts.defaultIconClass.includes("lucide"))return"lucide lucide-search";return"bi bi-search"}hideNoResults(){this.$o.find(".as-select3-no-results").remove()}selectAll(){this.multi&&(this.$e.find("option").prop("selected",!0),this.$o.find(".as-select3-option").addClass("selected").attr("aria-selected","true"),this.$o.find('input[type="checkbox"]').prop("checked",!0),this.updateFromSelect(),this.$e.trigger("change").trigger("asSelect3:selectall"))}clearAll(){this.$e.find("option").prop("selected",!1),this.multi?(this.vals=[],this.$o.find(".as-select3-option").removeClass("selected").attr("aria-selected","false"),this.$o.find('input[type="checkbox"]').prop("checked",!1)):(this.vals=null,this.$o.find(".as-select3-option").removeClass("selected").attr("aria-selected","false")),this.updateSelection(),this.$e.trigger("change").trigger("asSelect3:clearall")}async loadData(e,t={}){this.showLoading();try{const s=new URLSearchParams(t).toString(),i=await fetch(s?`${e}?${s}`:e);if(!i.ok)throw new Error(`HTTP ${i.status}`);const n=await i.json();n.options&&Array.isArray(n.options)?this.populateOptions(n.options):Array.isArray(n)?this.populateOptions(n):console.warn("Invalid data format"),this.$e.trigger("asSelect3:dataloaded",{data:n})}catch(e){console.error("Load data error:",e),this.showNoResults(),this.$e.trigger("asSelect3:dataerror",{error:e})}finally{this.hideLoading()}}updateSelection(){if(this.$s.empty(),this.multi)this.vals.length?this.vals.forEach(e=>{const t=this.$e.find(`option[value="${e}"]`),s=this.$o.find(`[data-value="${e}"]`);t.length&&this.$s.append(this.createTag(s.data("text")||t.text(),e,s.data("html"),s.data("icon")))}):this.$s.append(this.$p);else if(this.vals){const t=this.$e.find(`option[value="${this.vals}"]`),s=this.$o.find(`[data-value="${this.vals}"]`);if(t.length){const i=e('<div class="as-select3-single-container"></div>'),n=e('<span class="as-select3-single-value"></span>'),l=e(`<i class="${this.getCloseIcon()} as-select3-clear"></i>`).attr("data-value",this.vals);                if(this.opts.templateSelection&&"function"==typeof this.opts.templateSelection){const e=this.opts.templateSelection({id:this.vals,text:s.data("text")||t.text(),html:s.data("html")});e&&n.html(e)}else if(this.opts.allowHtml&&s.data("html")){const htmlContent=s.data("html");if(htmlContent!==s.data("text")&&htmlContent!==t.text()){n.html(this.opts.escapeMarkup(htmlContent))}else{let o=s.data("icon")||t.data("icon");if(o){const t=e('<div class="as-select3-single-icon"></div>');this.addIcon(t,o,"16px"),n.append(t)}n.append(e("<span></span>").text(s.data("text")||t.text()))}}else{let o=s.data("icon")||t.data("icon");if(o){const t=e('<div class="as-select3-single-icon"></div>');this.addIcon(t,o,"16px"),n.append(t)}n.append(e("<span></span>").text(s.data("text")||t.text()))}i.append(n,l),this.$s.append(i)}}else this.$s.append(this.$p);this.updateOptStates()}updateOptStates(){if(!this.multi||!this.opts.maxSelection)return;const t=this.vals.length>=this.opts.maxSelection;this.$o.find(".as-select3-option").each((s,i)=>{const n=e(i),l=n.hasClass("selected"),o=n.find('input[type="checkbox"]');t&&!l?(n.addClass("disabled").attr("aria-disabled","true"),o.prop("disabled",!0)):(n.removeClass("disabled").attr("aria-disabled","false"),o.prop("disabled",!1))})}createTag(t,s,i,n){const l=e('<span class="as-select3-tag"></span>').data("value",s);let o,a;if(this.opts.templateSelection&&"function"==typeof this.opts.templateSelection){const e=this.opts.templateSelection({id:s,text:t,html:i});e&&(o=e('<span class="as-select3-tag-content"></span>').html(e),a=e(`<i class="${this.getCloseIcon()} as-select3-tag-remove"></i>`),l.append(o,a))}else if(this.opts.allowHtml&&i&&i!==t){o=e('<span class="as-select3-tag-content"></span>').html(this.opts.escapeMarkup(i)),a=e(`<i class="${this.getCloseIcon()} as-select3-tag-remove"></i>`),l.append(o,a)}else{if(n){const t=e('<div class="as-select3-tag-icon"></div>');this.addIcon(t,n),l.append(t)}o=e('<span class="as-select3-tag-text"></span>').text(t).attr("title",t),a=e(`<i class="${this.getCloseIcon()} as-select3-tag-remove"></i>`),l.append(o,a)}return l}removeTag(e){const t=this.$e.find(`option[value="${e}"]`),s=this.$o.find(`[data-value="${e}"]`);t.length&&(t.prop("selected",!1),this.multi?(s.find('input[type="checkbox"]').prop("checked",!1),this.vals=this.vals.filter(t=>t!==e)):this.vals=null,s.removeClass("selected").attr("aria-selected","false"),this.updateSelection(),this.$e.trigger("change").trigger("asSelect3:tagremoved",{value:e}))}clearSingle(){this.vals=null,this.$e.find("option").prop("selected",!1),this.$o.find(".as-select3-option").removeClass("selected").attr("aria-selected","false"),this.updateSelection(),this.$e.trigger("change").trigger("asSelect3:cleared")}clearSelection(){this.multi?this.clearAll():this.clearSingle()}updateFromSelect(){this.multi?(this.vals=[],this.$e.find("option:selected").each((e,t)=>this.vals.push(t.value))):(this.vals=this.$e.find("option:selected").val()||null),this.updateSelection()}storeOrig(){this.orig=this.$e.find("option").map(function(){return{value:this.value,text:this.text,selected:this.selected,html:e(this).data("html"),icon:e(this).data("icon")}}).get()}populateOptions(t=[]){this.$e.empty(),this.$o.empty(),t.forEach((t,s)=>{const i=e("<option></option>").val(t.value).text(t.text||t.label).prop("selected",!!t.selected);t.icon&&i.data("icon",t.icon),t.html&&i.data("html",t.html),t.disabled&&i.prop("disabled",!0),this.$e.append(i),this.$o.append(this.createOpt({value:t.value,text:t.text||t.label,selected:!!t.selected,icon:t.icon,html:t.html,disabled:!!t.disabled},s))}),this.updateFromSelect()}addOption(t){const s=e("<option></option>").val(t.value).text(t.text||t.label).prop("selected",!!t.selected);return t.icon&&s.data("icon",t.icon),t.html&&s.data("html",t.html),t.disabled&&s.prop("disabled",!!t.disabled),this.$e.append(s),this.$o.append(this.createOpt(t,this.$e.find("option").length-1)),t.selected&&this.updateFromSelect(),this.$e.trigger("asSelect3:optionadded",{option:t}),s}removeOption(e){this.$e.find(`option[value="${e}"]`).remove(),this.$o.find(`[data-value="${e}"]`).remove(),this.multi?this.vals=this.vals.filter(t=>t!==e):this.vals===e&&(this.vals=null),this.updateSelection(),this.$e.trigger("asSelect3:optionremoved",{value:e})}clearOptions(){this.$e.empty(),this.$o.empty(),this.vals=this.multi?[]:null,this.updateSelection(),this.$e.trigger("asSelect3:optionscleared")}refreshOptions(){this.$o.empty(),this.$e.find("option").each((e,t)=>this.$o.append(this.createOpt(t,e))),this.updateFromSelect()}getValue(){return this.vals}setValue(e){Array.isArray(e)&&this.multi?(this.$e.find("option").prop("selected",!1),e.forEach(e=>this.$e.find(`option[value="${e}"]`).prop("selected",!0))):!Array.isArray(e)&&!this.multi&&(this.$e.find("option").prop("selected",!1),this.$e.find(`option[value="${e}"]`).prop("selected",!0)),this.updateFromSelect(),this.$e.trigger("change").trigger("asSelect3:valuechanged",{value:this.getValue()})}reset(){this.clearAll(),this.orig.forEach(e=>{e.selected&&(this.multi?this.vals.push(e.value):this.vals=e.value)}),this.updateFromSelect()}enable(){this.$c.removeClass("disabled"),this.$t.attr("tabindex","0"),this.$e.prop("disabled",!1)}disable(){this.close(),this.$c.addClass("disabled"),this.$t.attr("tabindex","-1"),this.$e.prop("disabled",!0)}destroy(){return this.close(),this.$t.off(),this.$c.off(),this.$o.off(),e(document).off("click.asSelect3"),this.$e.off("invalid").closest("form").off("reset.asSelect3"),this.$e.removeClass("d-none").insertAfter(this.$c),this.$c.remove(),delete this.el._asSelect3,this.$e}}e.fn.asSelect3=function(e){return this.each(function(){this._asSelect3||(this._asSelect3=new t(this,e))})},t.autoInit=function(s=".as-select3-container select"){return e(s).filter(function(){return!this._asSelect3}).map(function(){const e=new t(this);return this._asSelect3=e,e}).get()},window.AsSelect3=t}(jQuery);